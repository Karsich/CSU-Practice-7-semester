# Исправление проблемы со статистикой

## Проблемы, которые были найдены и исправлены:

### 1. Отсутствие данных в БД
- **Проблема**: В таблице `load_data` не было записей (0 записей)
- **Решение**: Создан скрипт `backend/create_test_data.py` для генерации тестовых данных
- **Результат**: Создано 2520 записей за последние 7 дней для всех 15 остановок

### 2. Несоответствие полей в frontend
- **Проблема**: Frontend использовал `avg_load`, но API возвращает `avg_people`
- **Решение**: Исправлен `frontend/app.js` - заменено `avg_load` на `avg_people`
- **Также**: Исправлено отображение часов пик (используются правильные поля из API)

### 3. Отсутствие обработки пустых данных
- **Проблема**: API не обрабатывал случай, когда данных нет
- **Решение**: Добавлена обработка пустых данных во все endpoints в `backend/api/analytics.py`
- **Также**: Добавлена обработка ошибок в `frontend/app.js`

## Как проверить работу:

1. **Проверить данные в БД:**
   ```bash
   cd backend
   python check_data.py
   ```

2. **Создать тестовые данные (если нужно):**
   ```bash
   cd backend
   python create_test_data.py
   ```

3. **Проверить API:**
   - Откройте браузер и перейдите на `http://localhost`
   - Перейдите в раздел "Аналитика"
   - Выберите остановку и период
   - Нажмите "Загрузить"
   - Должна отобразиться статистика с графиками

4. **Проверить API напрямую:**
   ```bash
   cd backend
   python test_analytics_api.py
   ```

## Важно: Автоматический сбор данных

Данные должны собираться автоматически через Celery задачи:
- `monitor_all_stops_passive` - запускается каждую минуту через Celery Beat
- `monitor_stop_passive` - мониторит конкретную остановку

**Убедитесь, что запущены:**
- Celery Worker: `celery -A tasks.celery_app worker --loglevel=info`
- Celery Beat: `celery -A tasks.celery_app beat --loglevel=info`
- Или используйте docker-compose для автоматического запуска

## Файлы, которые были изменены:

1. `frontend/app.js` - исправлено отображение статистики
2. `backend/api/analytics.py` - добавлена обработка пустых данных
3. `backend/create_test_data.py` - новый скрипт для создания тестовых данных
4. `backend/check_data.py` - новый скрипт для проверки данных
5. `backend/test_analytics_api.py` - новый скрипт для тестирования API

